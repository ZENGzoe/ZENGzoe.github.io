<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 面试题之Javascript实现10万的阶乘 · 曾洁仪博客</title><meta name="description" content="面试题之Javascript实现10万的阶乘 - Zeng Zoe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="css/googleapisFonts.css" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/zengjieyi1994" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ZENGzoe" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">面试题之Javascript实现10万的阶乘</h1><div class="post-time">2019年9月17日</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近面试的时候遇到一道面试题，就是实现10000!，当时的第一反应是直接用递归实现：</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial_recursion</span><span class="params">(n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> n * factorial_recursion(n<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样就会存在问题，Js中最大的安全整数为2^53- 1，10000!结果溢出该范围，代码运行结果为Infinity，无法计算出正确的结果。</p>
<p>那么如何才能计算大数据的阶乘呢？</p>
<h2 id="BigInt"><a href="#BigInt" class="headerlink" title="BigInt"></a>BigInt</h2><p>可以使用Js最新的基本数据类型BigInt，BigInt数据类型支持范围更大的整数值，可以解决整数溢出问题。</p>
<p>BigInt数据通过BigInt构造函数创建，修改代码如下：</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial_recursion</span><span class="params">(n)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> BigInt(n) * BigInt(factorial_recursion(n<span class="number">-1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>factorial_recursion(10000)</code>就可以得出结果。</p>
<p>但当计算更高数值的阶乘时，比如求20000的阶乘，出现栈溢出的情况。</p>
<p>那么如何才能解决栈溢出问题？</p>
<h2 id="平方差实现"><a href="#平方差实现" class="headerlink" title="平方差实现"></a>平方差实现</h2><p><strong>算法思路</strong></p>
<p>可以从减少乘法运算的次数角度出发，阶乘运算可转换为若干个平方差的积，使得阶乘只需要n/2次乘法，并且得出规律平方差之间的差是连续的奇数。除了平方差乘数，其他乘数根据n为奇数或偶数也有不同规律。</p>
<p><strong>算法分析</strong></p>
<p>当计算9的阶乘时：<br><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> * <span class="number">2</span> * <span class="number">3</span> * <span class="number">4</span> * <span class="number">5</span> * <span class="number">6</span> * <span class="number">7</span> * <span class="number">8</span> * <span class="number">9</span> </span><br><span class="line"></span><br><span class="line">取中间值为基值： (<span class="number">5</span> - <span class="number">4</span>) * (<span class="number">5</span> - <span class="number">3</span>) * (<span class="number">5</span> - <span class="number">2</span>) * (<span class="number">5</span> - <span class="number">1</span>) * <span class="number">5</span> * (<span class="number">5</span> + <span class="number">1</span>) * (<span class="number">5</span> + <span class="number">2</span>) * (<span class="number">5</span> + <span class="number">3</span>) * (<span class="number">5</span> +<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">调换位置：(<span class="number">5</span> - <span class="number">1</span>) * (<span class="number">5</span> + <span class="number">1</span>) * (<span class="number">5</span> - <span class="number">2</span>) * (<span class="number">5</span> + <span class="number">2</span>) * (<span class="number">5</span> - <span class="number">3</span>) * (<span class="number">5</span> + <span class="number">3</span>) * (<span class="number">5</span> - <span class="number">4</span>) * (<span class="number">5</span> + <span class="number">4</span>) * <span class="number">5</span></span><br><span class="line"></span><br><span class="line">合并为平方差：(<span class="number">5</span>^<span class="number">2</span> - <span class="number">1</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">2</span>^<span class="number">2</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">3</span>^<span class="number">2</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">4</span>^<span class="number">2</span>) * <span class="number">5</span></span><br><span class="line"></span><br><span class="line">计算平方差结果： <span class="number">24</span> * <span class="number">21</span> * <span class="number">16</span> * <span class="number">9</span>  </span><br><span class="line"></span><br><span class="line">得出规律：<span class="number">24</span>、<span class="number">21</span>、<span class="number">16</span>、<span class="number">9</span>之间的差分别为基数<span class="number">3</span>、<span class="number">5</span>、<span class="number">7</span>，奇数基础乘数为 n / <span class="number">2</span></span><br></pre></td></tr></table></figure></p>
<p>当计算10的阶乘时：<br><figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> * <span class="number">2</span> * <span class="number">3</span> * <span class="number">4</span> * <span class="number">5</span> * <span class="number">6</span> * <span class="number">7</span> * <span class="number">8</span> * <span class="number">9</span> * <span class="number">10</span></span><br><span class="line"></span><br><span class="line">取中间值位基值： (<span class="number">5</span> - <span class="number">4</span>) * (<span class="number">5</span> - <span class="number">3</span>) * (<span class="number">5</span> - <span class="number">2</span>) * (<span class="number">5</span> - <span class="number">1</span>) * <span class="number">5</span> * (<span class="number">5</span> + <span class="number">1</span>) * (<span class="number">5</span> + <span class="number">2</span>) * (<span class="number">5</span> + <span class="number">3</span>) * (<span class="number">5</span> +<span class="number">4</span>) * (<span class="number">5</span> + <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">调换位置：(<span class="number">5</span> - <span class="number">1</span>) * (<span class="number">5</span> + <span class="number">1</span>) * (<span class="number">5</span> - <span class="number">2</span>) * (<span class="number">5</span> + <span class="number">2</span>) * (<span class="number">5</span> - <span class="number">3</span>) * (<span class="number">5</span> + <span class="number">3</span>) * (<span class="number">5</span> - <span class="number">4</span>) * (<span class="number">5</span> + <span class="number">4</span>) * <span class="number">5</span> * (<span class="number">5</span> + <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">合并为平方差：(<span class="number">5</span>^<span class="number">2</span> - <span class="number">1</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">2</span>^<span class="number">2</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">3</span>^<span class="number">2</span>) * (<span class="number">5</span>^<span class="number">2</span> - <span class="number">4</span>^<span class="number">2</span>) * <span class="number">5</span> * (<span class="number">5</span> + <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">平方差结果： <span class="number">24</span> * <span class="number">21</span> * <span class="number">16</span> * <span class="number">9</span>  </span><br><span class="line"></span><br><span class="line">得出规律：<span class="number">24</span>、<span class="number">21</span>、<span class="number">16</span>、<span class="number">9</span>之间的差分别为基数<span class="number">3</span>、<span class="number">5</span>、<span class="number">7</span>，偶数基础乘数为 n / <span class="number">2</span> * n</span><br></pre></td></tr></table></figure></p>
<p><strong>代码实现如下：</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial_square</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(n &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> middle = <span class="built_in">Math</span>.ceil(n / <span class="number">2</span>);    <span class="comment">//取中间值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> tmp = middle * middle,</span><br><span class="line">        result = n &amp; <span class="number">1</span> == <span class="number">1</span> ? middle : middle * n;  <span class="comment">//奇偶数的基础乘数规律不同</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">1</span> ; i &lt;= n - <span class="number">2</span> ; i += <span class="number">2</span>)&#123;   <span class="comment">//连续减奇数得出各项乘数</span></span><br><span class="line">        tmp -= i;</span><br><span class="line">        result = BigInt(result) * BigInt(tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BigInt兼容性并不友好，Chrome浏览器在67+版本中才支持该数据类型。</p>
<p>在不支持BigInt的浏览器中怎么计算大数据阶乘呢？</p>
<h2 id="数组存储实现"><a href="#数组存储实现" class="headerlink" title="数组存储实现"></a>数组存储实现</h2><p><strong>算法思路</strong></p>
<p>可以使用数组来存储大数据结果的每位数，如result[0]存储个位数，result[1]存储十位数，以此类推。计算每位数时需要加上上一个位数得出的进位，最后再将数组反转并拼接，就可以得出大数据结果。</p>
<p><strong>算法分析</strong></p>
<p>以5! = 1 <em> 2 </em> 3 <em> 4 </em> 5为例：</p>
<p><img src="/2019/09/18/面试题之实现10万的阶乘/array.png" alt="2019-09-17-面试题之实现10万的阶乘"></p>
<p><strong>代码实现</strong></p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">function factorial_array(n)&#123;</span><br><span class="line"></span><br><span class="line">    let result = [<span class="number">1</span>],   <span class="comment">//存储结果</span></span><br><span class="line">        digit = <span class="number">1</span>,      <span class="comment">//位数，从第1位开始</span></span><br><span class="line">        count ,         <span class="comment">//每次计算的结果</span></span><br><span class="line">        num ,           <span class="comment">//阶乘的计算到的第几个</span></span><br><span class="line">        i ,             <span class="comment">//result中每一项</span></span><br><span class="line">        carry;          <span class="comment">//每次得数的进位</span></span><br><span class="line"></span><br><span class="line">    for(num = <span class="number">2</span> ; num &lt;= n ; num++)&#123;</span><br><span class="line">        for(i = <span class="number">1</span> , carry = <span class="number">0</span> ; i &lt;= digit ; i++)&#123;</span><br><span class="line">            count = result[i - <span class="number">1</span>] * num + carry;        <span class="comment">//每一项计算结果</span></span><br><span class="line">            result[i - <span class="number">1</span>] = count % <span class="number">10</span>;                 <span class="comment">//将一个数的每一位数利用数组进行储存</span></span><br><span class="line">            carry = (count - result[i - <span class="number">1</span>]) / <span class="number">10</span>        <span class="comment">//记录进位</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        while (carry) &#123; <span class="comment">//如果还有进位，继续存储</span></span><br><span class="line">            result[digit] = carry % <span class="number">10</span>;</span><br><span class="line">            carry = (carry - result[digit]) / <span class="number">10</span>;</span><br><span class="line">            digit++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return result.reverse().join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>1.递归实现</strong></p>
<p>优点：实现代码简单，速度快</p>
<p>缺点：较大数据容易出现栈溢出，兼容性不够友好 </p>
<p><strong>2.平方差实现</strong></p>
<p>优点：乘数计算少，速度快</p>
<p>缺点：兼容性不够友好 </p>
<p><strong>3.数组存储实现</strong></p>
<p>优点：数组清晰地存放大数据的每个位数，每次计算时能简单地从低位到高位求值</p>
<p>缺点：需要用数组存储大数据的每位数，需要占用较大内存，速度较慢</p>
<p><a href="https://github.com/ZENGzoe/factorialDemo" target="_blank" rel="noopener">demo地址</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2019/04/12/数据库递归查询：MySQL-VS-Sequelize/" class="next">NEXT</a></div><div data-thread-key="2019/09/18/面试题之实现10万的阶乘/" data-title="面试题之Javascript实现10万的阶乘" data-url="http://zengzoe.github.io/2019/09/18/面试题之实现10万的阶乘/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"zengzoe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 - 2019 <a href="http://zengzoe.github.io">Zeng Zoe</a>, unless otherwise noted.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>