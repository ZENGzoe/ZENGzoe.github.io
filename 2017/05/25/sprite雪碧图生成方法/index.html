<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> sprite雪碧图生成方法 · 曾洁仪博客</title><meta name="description" content="sprite雪碧图生成方法 - Zeng Zoe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="css/googleapisFonts.css" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/zengjieyi1994" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ZENGzoe" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">sprite雪碧图生成方法</h1><div class="post-time">2017年5月25日</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在项目中，有时候需要用到很多小的图片，那么页面访问过程中就需要一次一次地向服务器很多的这样小的图片，严重影响到页面的性能。我们可以将多个小的图片合成一张图片，这样的话页面会只请求一次，从而优化我们的性能。这样的图片叫做CSS Sprites,也叫雪碧图。<br><img src="/2017/05/25/sprite雪碧图生成方法/01.png" alt=""></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>要合成雪碧图的方法很多，从总体上可按照生成的环境分为项目外生成和项目中生成，项目外生成即用其他工具合并生成，比如线上工具<a href="http://spritegen.website-performance.org/" target="_blank" rel="noopener">CSS Sprite Generator</a>、Animation CC等，除了生成雪碧图外，还可以导出雪碧图中包含各个子图的尺寸和偏移量的文本。具体实现方法可自行搜索，在这篇文章中，主要是介绍项目中生成的方法，即在项目开发过程中，可配置相关代码自动生成雪碧图。与项目外生成方法相比，这个比较大的优点是不用手动添加各个子图的尺寸和背景位置，能够减少较大的时间成本，有利于项目的快速开发。</p>
<h3 id="方法一：Postcss"><a href="#方法一：Postcss" class="headerlink" title="方法一：Postcss"></a>方法一：Postcss</h3><p><code>PostCss</code>是一种可以用Javascript代码来处理CSS的工具，可对CSS进行模块化转换，将CSS代码解析成抽象语法树结构，再由插件来进行处理。因此在项目中，可使用其<code>postcss-sprites</code>插件将图片生成雪碧图图。同时，使用Webpack模块加载器来处理CSS和图片。具体实现方法如下：</p>
<p><strong> 1.安装加载器与插件 </strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install</span> -<span class="keyword">save</span>-dev <span class="keyword">style</span>-loader css-loader postcss-loader <span class="keyword">file</span>-loader postcss-sprites <span class="keyword">extract</span>-<span class="built_in">text</span>-webpack-<span class="keyword">plugin</span> html-webpack-<span class="keyword">plugin</span></span><br></pre></td></tr></table></figure>
<p>使用postcss，需要用到样式加载器、css加载器、postcss加载器三种加载器来处理css。<br><code>postcss-sprite</code> ：用来合并雪碧图。<br><code>file-loader</code> ：用来处理图片。<br><code>extract-text-webpack-plugin</code> ： 用来从出口文件中提取文本到一个单独的文件中。<br><code>html-webpack-plugin</code> ： 创建HTML文件</p>
<p><strong> 2.配置webpack.config.js </strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    devtool : <span class="string">"inline-source-map"</span>,          </span><br><span class="line">    entry : <span class="string">"./src/js/index.js"</span>,</span><br><span class="line">    output : &#123;</span><br><span class="line">        path : __dirname + <span class="string">"/dist/js"</span>,</span><br><span class="line">        filename : <span class="string">"bundle.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devServer : &#123;</span><br><span class="line">        compress : <span class="literal">false</span>,</span><br><span class="line">        contentBase : __dirname,</span><br><span class="line">        publicPath : <span class="string">'/'</span>,</span><br><span class="line">        port : <span class="number">8081</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span> : &#123;</span><br><span class="line">        loaders : [</span><br><span class="line">            &#123; </span><br><span class="line">                test : <span class="regexp">/\.js|.jsx?$/</span>, </span><br><span class="line">                loader : <span class="string">'babel-loader'</span>,</span><br><span class="line">                exclude : <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        rules : [</span><br><span class="line">            &#123;</span><br><span class="line">                test : <span class="regexp">/\.css$/</span>,</span><br><span class="line">                exclude : <span class="regexp">/dist/</span>,</span><br><span class="line">                use : ExtractTextPlugin.extract(&#123;</span><br><span class="line">                    fallback : <span class="string">'style-loader'</span>,</span><br><span class="line">                    use : [<span class="string">'css-loader?module&amp;localIdentName=[local]'</span>,<span class="string">'postcss-loader'</span>]</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test : <span class="regexp">/\.(jpg|png)$/</span>,</span><br><span class="line">                use : <span class="string">'file-loader?name=../img/[name].[ext]'</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins : [</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"../css/global.css"</span>),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            title : <span class="string">"postcss生成雪碧图"</span>,</span><br><span class="line">            filename : <span class="string">"../index.html"</span>,</span><br><span class="line">            template : <span class="string">'src/index.html'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>入口文件为<code>src/js/index.js</code>，<code>ExtractTextPlugin</code>将出口文件<code>bundle.js</code>中的css分离出成为一个独立<code>global.css</code>文件。</p>
<p><strong> 3.配置postcss </strong><br>在根目录下，创建文件<code>postcss.config.js</code>，配置如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> opts = &#123;</span><br><span class="line">    stylesheetPath : <span class="string">'./src/img'</span>,</span><br><span class="line">    spritePath : <span class="string">'./dist/img/'</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins : [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(opts)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>stylesheetPath</code>为源图片路径，<code>spritePath</code>为生成雪碧图地址。</p>
<p><strong> 4.运行 </strong></p>
<figure class="highlight axapta"><table><tr><td class="code"><pre><span class="line">webpack-dev-<span class="keyword">server</span></span><br></pre></td></tr></table></figure>
<p>到这里就可以生成想要的雪碧图：</p>
<p><strong> Before: </strong></p>
<p>图片：</p>
<p><img src="/2017/05/25/sprite雪碧图生成方法/02.png" alt=""></p>
<p>CSS：</p>
<p><img src="/2017/05/25/sprite雪碧图生成方法/03.png" alt=""></p>
<p><strong> After: </strong></p>
<p>图片：</p>
<p><img src="/2017/05/25/sprite雪碧图生成方法/04.png" alt=""></p>
<p>CSS：</p>
<p><img src="/2017/05/25/sprite雪碧图生成方法/05.png" alt=""></p>
<p><strong> 5.添加分组 </strong></p>
<p>如果图片太多，可将图片合成多个雪碧图，这时需要根据分组修改图片名称。<br>比如，当我需要将以上的11张图片合成两张雪碧图<code>sprite1.png</code>和<code>sprite2.png</code>，则需要将图片名称改为包含sprite1或sprite2的新名称，包含sprite1或sprite2名称的图片合并到<code>sprite1.png</code>或<code>sprite2.png</code>。如下：<br><img src="/2017/05/25/sprite雪碧图生成方法/06.png" alt=""></p>
<p>并修改<code>postcss.config.js</code>如下：<br><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> opts = &#123;</span><br><span class="line">    stylesheetPath : <span class="string">'./src/img'</span>,</span><br><span class="line">    spritePath : <span class="string">'./dist/img/'</span>,</span><br><span class="line">    groupBy : [</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">image</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (image.url.indexOf(<span class="string">'sprite1'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">'sprite1'</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">image</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (image.url.indexOf(<span class="string">'sprite2'</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="string">'sprite2'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins : [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'postcss-sprites'</span>)(opts)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用<code>groupBy</code>来配置我们的分组。</p>
<p>最终图片合成如下：<br><img src="/2017/05/25/sprite雪碧图生成方法/07.png" alt=""></p>
<p><strong> 6.修改图片单位 </strong></p>
<p>在项目中，我们可能会使用REM布局，需要将图片的单位改为<code>rem</code>。直接修改<code>postcss.config.js</code>如下：<br><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">let psdSize = <span class="number">750</span>;      <span class="comment">//设计稿宽度</span></span><br><span class="line">let RemRatio = <span class="number">16</span>;      <span class="comment">//REM 换算比值</span></span><br><span class="line">let postcss = require(<span class="string">'postcss'</span>);</span><br><span class="line">let opts = &#123;</span><br><span class="line">    <span class="string">stylesheetPath :</span> <span class="string">'./src/img'</span>,</span><br><span class="line">    <span class="string">spritePath :</span> <span class="string">'./dist/img/'</span>,</span><br><span class="line">    <span class="string">hooks :</span> &#123;</span><br><span class="line">        <span class="string">onUpdateRule :</span> function(rule,token,image)&#123;</span><br><span class="line">            let backgroundSizeX = image.spriteWidth<span class="regexp">/(psdSize/</span>RemRatio/<span class="number">1</span>),</span><br><span class="line">                backgroundSizeY = image.spriteHeight<span class="regexp">/(psdSize/</span>RemRatio/<span class="number">1</span>),</span><br><span class="line">                backgroundPositionX = image.coords.x<span class="regexp">/(psdSize/</span>RemRatio/<span class="number">1</span>),</span><br><span class="line">                backgroundPositionY = image.coords.y<span class="regexp">/(psdSize/</span>RemRatio/<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            backgroundSizeX = isNaN(backgroundSizeX) ? 0 : backgroundSizeX.toFixed(<span class="number">3</span>);</span><br><span class="line">            backgroundSizeY = isNaN(backgroundSizeY) ? 0 : backgroundSizeY.toFixed(<span class="number">3</span>);</span><br><span class="line">            backgroundPositionX = isNaN(backgroundPositionX) ? 0 : backgroundPositionX.toFixed(<span class="number">3</span>);</span><br><span class="line">            backgroundPositionY = isNaN(backgroundPositionY) ? 0 : backgroundPositionY.toFixed(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">            let backgroundImage = postcss.decl(&#123;</span><br><span class="line">                <span class="string">prop :</span> <span class="string">'background-image'</span>,</span><br><span class="line">                <span class="string">value :</span> <span class="string">'url('</span> + image.spriteUrl + <span class="string">')'</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            let backgroundSize = postcss.decl(&#123;</span><br><span class="line">                <span class="string">prop :</span> <span class="string">'background-size'</span>,</span><br><span class="line">                <span class="string">value :</span> backgroundSizeX + <span class="string">'rem '</span> + backgroundSizeY + <span class="string">'rem'</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            let backgroundPosition = postcss.decl(&#123;</span><br><span class="line">                <span class="string">prop :</span> <span class="string">'background-position'</span>,</span><br><span class="line">                <span class="string">value :</span> backgroundPositionX + <span class="string">'rem '</span> + backgroundPositionY + <span class="string">'rem'</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            rule.insertAfter(token,backgroundImage);</span><br><span class="line">            rule.insertAfter(backgroundImage,backgroundPosition);</span><br><span class="line">            rule.insertAfter(backgroundPosition,backgroundSize);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    <span class="string">plugins :</span> [</span><br><span class="line">        require(<span class="string">'postcss-sprites'</span>)(opts)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>使用<code>hooks.onUpdateRule</code>来重写输出的图片样式。换算公式可根据自己的需求修改。<br>最终CSS结果如下：<br><img src="/2017/05/25/sprite雪碧图生成方法/08.png" alt=""></p>
<h3 id="方法二：Composs-Sass"><a href="#方法二：Composs-Sass" class="headerlink" title="方法二：Composs+Sass"></a>方法二：Composs+Sass</h3><p>Sass是一种CSS预处理器，通过搭配Compass,可以更好的实现合并生成雪碧图。</p>
<p><strong> 1.声明雪碧图 </strong></p>
<p>Compass中有多种包装好的模块，使用其中的雪碧地图(Sprite maps)来实现雪碧图的合成。声明雪碧图如下：</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">$sprite1 : sprite-<span class="keyword">map</span>(<span class="string">"sprite1/*.png"</span>,$spacing : <span class="number">10</span>px , $layout : <span class="string">'vertical'</span>);</span><br><span class="line">$sprite2 : sprite-<span class="keyword">map</span>(<span class="string">"sprite2/*.png"</span>,$spacing : <span class="number">10</span>px , $layout : <span class="string">'vertical'</span>);</span><br></pre></td></tr></table></figure>
<p>声明两个雪碧图分别为<code>$sprite1</code>和<code>$sprite2</code>,<code>sprite-map</code>第一个参数为<code>config.rb</code>配置文件中<code>images_dir</code>下雪碧图集的地址，$spacing为图片间隔，默认为0。<code>$layout</code>为图片的排列方式。有四种排列方式：<code>vertical</code>、<code>horizontal</code>、<code>diagonal</code>、<code>smart</code>。主要分别如下：<br><img src="/2017/05/25/sprite雪碧图生成方法/09.jpg" alt=""></p>
<p><strong> 2.完成style.scss </strong></p>
<p>根据需求，配置样式如下：</p>
<p><code>style.scss</code>:<br><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sprite1</span> : sprite-map(<span class="string">"sprite1/*.png"</span>,<span class="variable">$spacing</span> : <span class="number">10px</span> , <span class="variable">$layout</span> : <span class="string">'vertical'</span>);</span><br><span class="line"><span class="variable">$sprite2</span> : sprite-map(<span class="string">"sprite2/*.png"</span>,<span class="variable">$spacing</span> : <span class="number">10px</span> , <span class="variable">$layout</span> : <span class="string">'vertical'</span>);</span><br><span class="line"></span><br><span class="line">@function pxToRem (<span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="variable">$value</span> : <span class="variable">$value</span> / (<span class="variable">$value</span> * <span class="number">0</span> + <span class="number">1</span>);  <span class="comment">//去单位px</span></span><br><span class="line">    @return <span class="variable">$value</span>/(<span class="number">750px</span>/<span class="number">16px</span>/<span class="number">1rem</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">mixin</span> spritesMixin(<span class="variable">$name</span>,<span class="variable">$sprites</span>)&#123;</span><br><span class="line">    <span class="variable">$iconPath</span>:sprite-file(<span class="variable">$sprites</span>,<span class="variable">$name</span>);</span><br><span class="line">    <span class="variable">$iconWidth</span>:image-width(<span class="variable">$iconPath</span>);</span><br><span class="line">    <span class="variable">$iconHeight</span>:image-height(<span class="variable">$iconPath</span>);</span><br><span class="line">    <span class="variable">$iconPosX</span> : nth(sprite-position(<span class="variable">$sprites</span>,<span class="variable">$name</span>),<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$iconPosY</span> : nth(sprite-position(<span class="variable">$sprites</span>,<span class="variable">$name</span>),<span class="number">2</span>);</span><br><span class="line">    <span class="attribute">background-repeat</span>:no-repeat;</span><br><span class="line">    <span class="attribute">background-image</span>:sprite-url(<span class="variable">$sprites</span>);</span><br><span class="line">    <span class="attribute">width</span>:pxToRem(<span class="variable">$iconWidth</span>);</span><br><span class="line">    <span class="attribute">height</span>: pxToRem(<span class="variable">$iconHeight</span>);</span><br><span class="line">    <span class="attribute">background</span>:pxToRem(<span class="variable">$iconPosX</span>) pxToRem(<span class="variable">$iconPosY</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.a</span>&#123;</span><br><span class="line">    @<span class="keyword">include</span> spritesMixin(a,<span class="variable">$sprite1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.b</span>&#123;</span><br><span class="line">    @<span class="keyword">include</span> spritesMixin(b,<span class="variable">$sprite1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>pxToRem</code> : 将px转化为rem。<br><code>spritesMixin</code> : 声明需要引用雪碧图的代码块。<br><code>sprite-file</code> : 用于在雪碧图上找到需要的图片。<br><code>image-width</code>、<code>image-height</code> : 获取该图片的长度和宽度。<br><code>sprite-position</code> : 获取该图片在雪碧图上的位置。<br><code>nth</code> : 取值。</p>
<p>在每个需要雪碧图的位置上直接引入<code>@include spritesMixin($name,$sprites)</code>即可，<code>$name</code>为该图片的名称，<code>$sprites</code>为声明的雪碧图。</p>
<p>转化后的<code>style.css</code>:<br><img src="/2017/05/25/sprite雪碧图生成方法/10.png" alt=""></p>
<p>如果想要更简单的自动生成，只需要改为简单的几行：<br><figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"compass/utilities/sprites"</span>;       <span class="comment">//导入sprites模块</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"sprite1/*.png"</span>;                   <span class="comment">//导入sprite1的图片</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"sprite2/*.png"</span>;                   <span class="comment">//导入sprite2的图片</span></span><br><span class="line">@<span class="keyword">include</span> all-sprite1-sprites;              <span class="comment">//自动根据文件名生成类</span></span><br><span class="line">@<span class="keyword">include</span> all-sprite2-sprites;              <span class="comment">//自动根据文件名生成类</span></span><br></pre></td></tr></table></figure></p>
<p>这样转化后的样式中就能根据文件名来生成类，所以我们在使用之前能够根据文件名来定义我们的类并且加入到我们的结构中，这样不用在每一个需要的地方重新加入相应的样式。</p>
<h3 id="方法三：Grunt"><a href="#方法三：Grunt" class="headerlink" title="方法三：Grunt"></a>方法三：Grunt</h3><p>如果使用了工具Grunt,那么就可以使用<code>grunt-css-sprite</code>插件来实现雪碧图的生成。</p>
<p><strong> 1.安装插件 </strong></p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">npm install grunt-css-sprite --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p><strong> 2.配置Gruntfile.js </strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">grunt</span>) </span>&#123;</span><br><span class="line">    grunt.initConfig(&#123;</span><br><span class="line">        pkg: grunt.file.readJSON(<span class="string">'package.json'</span>),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 自动雪碧图</span></span><br><span class="line">        sprite: &#123;</span><br><span class="line">            options: &#123;</span><br><span class="line">                <span class="comment">// sprite背景图源文件夹</span></span><br><span class="line">                imagepath: <span class="string">'src/img/'</span>,</span><br><span class="line">                <span class="comment">// 映射CSS中背景路径</span></span><br><span class="line">                imagepath_map: <span class="literal">null</span>,</span><br><span class="line">                <span class="comment">// 雪碧图输出目录</span></span><br><span class="line">                spritedest: <span class="string">'build/img/'</span>,</span><br><span class="line">                <span class="comment">// 替换后的背景路径</span></span><br><span class="line">                spritepath: <span class="string">'../img/'</span>,</span><br><span class="line">                <span class="comment">// 图片间间距</span></span><br><span class="line">                padding: <span class="number">2</span>,</span><br><span class="line">                <span class="comment">// 是否使用 image-set 作为2x图片实现</span></span><br><span class="line">                useimageset: <span class="literal">false</span>,</span><br><span class="line">                <span class="comment">// 是否以时间戳为文件名生成新的雪碧图文件</span></span><br><span class="line">                newsprite: <span class="literal">false</span>,</span><br><span class="line">                <span class="comment">// 给雪碧图追加时间戳</span></span><br><span class="line">                spritestamp: <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 在CSS文件末尾追加时间戳</span></span><br><span class="line">                cssstamp: <span class="literal">true</span>,</span><br><span class="line">                <span class="comment">// 默认使用二叉树最优排列算法</span></span><br><span class="line">                algorithm: <span class="string">'binary-tree'</span>,</span><br><span class="line">                <span class="comment">// 默认使用`pngsmith`图像处理引擎</span></span><br><span class="line">                engine: <span class="string">'pngsmith'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            autoSprite: &#123;</span><br><span class="line">                files: [&#123;</span><br><span class="line">                    <span class="comment">// 启用动态扩展</span></span><br><span class="line">                    expand: <span class="literal">true</span>,</span><br><span class="line">                    <span class="comment">// css文件源的文件夹</span></span><br><span class="line">                    cwd: <span class="string">'src/css/'</span>,</span><br><span class="line">                    <span class="comment">// 匹配规则</span></span><br><span class="line">                    src: <span class="string">'*.css'</span>,</span><br><span class="line">                    <span class="comment">// 导出css和sprite的路径地址</span></span><br><span class="line">                    dest: <span class="string">'build/css/'</span>,</span><br><span class="line">                    <span class="comment">// 导出的css名</span></span><br><span class="line">                    ext: <span class="string">'.sprite.css'</span></span><br><span class="line">                &#125;]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载指定插件任务</span></span><br><span class="line">    grunt.loadNpmTasks(<span class="string">'grunt-css-sprite'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 默认执行的任务</span></span><br><span class="line">    grunt.registerTask(<span class="string">'default'</span>, [<span class="string">'sprite'</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>grunt-css-sprite</code>插件会根据样式文件中引用的图片来进行雪碧图的合并。</p>
<p><code>algorithm</code>配置图片的排列方式，有五个选项，分别为<code>top-down</code>(从上至下)、<code>left-right</code>(从左至右)、<code>diagonal</code>(从左上至右下)、<code>alt-diagonal</code>(从左下至右上)、<code>binary-tree</code>(二叉树排列)，可根据自己的爱好进行配置。</p>
<p>但由于其配置参数的限制，不能满足较特殊的项目需求，比如不能对图片分组合并等。</p>
<h3 id="方法四：Gulp"><a href="#方法四：Gulp" class="headerlink" title="方法四：Gulp"></a>方法四：Gulp</h3><p>如果使用了工具Gulp，可使用插件<code>grunt.spritesmith</code>来合成雪碧图。</p>
<p><strong> 1.安装插件 </strong></p>
<figure class="highlight q"><table><tr><td class="code"><pre><span class="line">npm install gulp.spritesmith --<span class="built_in">save</span>-<span class="built_in">dev</span></span><br></pre></td></tr></table></figure>
<p><strong> 2.配置Gulpfile.js </strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>),</span><br><span class="line">    spritesmith = <span class="built_in">require</span>(<span class="string">'gulp.spritesmith'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'default'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> gulp.src(<span class="string">"src/img/*.png"</span>)</span><br><span class="line">        .pipe(spritesmith(&#123;</span><br><span class="line">            imgName : <span class="string">'img/sprite.png'</span>,</span><br><span class="line">            cssName : <span class="string">'css/style.css'</span>,</span><br><span class="line">            padding : <span class="number">5</span> ,</span><br><span class="line">            algorithm : <span class="string">'binary-tree'</span>,</span><br><span class="line">            cssTemplate : <span class="string">'src/css/spriteTemplate.css'</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(gulp.dest(<span class="string">'dist/'</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>Gulpfile.js</code>的配置相对简单，<code>grunt.spritesmith</code>插件则会根据<code>src/img/*.png</code>目录中配置的图片进行合并雪碧图。<br><code>algorithm</code>配置图片的排列方式，同<code>grunt-css-sprite</code>中<code>algorithm</code>的配置。<br><code>cssTemplate</code>为生成雪碧图样式的模版文件，可以是字符串也可以是函数。如果是字符串，则为模版的地址，则在样式文件中的配置请看3.配置css模版。如果是函数，则可以配置为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">cssTemplate: <span class="function"><span class="keyword">function</span> <span class="params">(data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr=[];</span><br><span class="line">    data.sprites.<span class="keyword">forEach</span>(<span class="function"><span class="keyword">function</span> <span class="params">(sprite)</span> </span>&#123;</span><br><span class="line">        arr.push(<span class="string">".icon-"</span>+sprite.name+</span><br><span class="line">        <span class="string">"&#123;"</span> +</span><br><span class="line">        <span class="string">"background-image: url('"</span>+sprite.escaped_image+<span class="string">"');"</span>+</span><br><span class="line">        <span class="string">"background-position: "</span>+sprite.px.offset_x+<span class="string">"px "</span>+sprite.px.offset_y+<span class="string">"px;"</span>+</span><br><span class="line">        <span class="string">"width:"</span>+sprite.px.width+<span class="string">";"</span>+</span><br><span class="line">        <span class="string">"height:"</span>+sprite.px.height+<span class="string">";"</span>+</span><br><span class="line">        <span class="string">"&#125;\n"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> arr.join(<span class="string">""</span>);</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p><strong> 3.配置css模版 </strong></p>
<p>在<code>style.css</code>中，</p>
<figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line">&#123;&#123;#sprites&#125;&#125;   //模版开始</span><br><span class="line">.icon-&#123;&#123;name&#125;&#125;&#123;</span><br><span class="line">    background-image: url(<span class="string">"&#123;&#123;escaped_image&#125;&#125;"</span>);                </span><br><span class="line">    background-position: &#123;&#123;px.offset_x&#125;&#125; &#123;&#123;px.offset_y&#125;&#125;;</span><br><span class="line">    width: &#123;&#123;px.width&#125;&#125;;</span><br><span class="line">    height: &#123;&#123;px.height&#125;&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#123;&#123;/sprites&#125;&#125;   //模版开始</span><br></pre></td></tr></table></figure>
<p><code>name</code>：图片名。<br><code>escaped_image</code>：图片的地址。<br><code>px</code>：图片在雪碧图的数据对象，offset_x为x偏移单位，offset_y为y偏移单位，width为宽度，height为高度。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上面主要是总结了四种方法，各有各的优势，可根据自己的需求进行配置。磨刀不误砍柴工，配置好了，才能更好地节省时间完成项目开发。</p>
<p>DEMO源码地址：<img src="https://github.com/ZENGzoe/Stylesheet" alt="demo"></p>
</div></article></div></section><footer><div class="paginator"><a href="/2018/06/04/hexo博客如何提速/" class="prev">PRVE</a><a href="/2017/04/18/基于react-nodejs-mongodb-webpack-redux实现图片上传应用/" class="next">NEXT</a></div><div data-thread-key="2017/05/25/sprite雪碧图生成方法/" data-title="sprite雪碧图生成方法" data-url="http://zengzoe.github.io/2017/05/25/sprite雪碧图生成方法/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"zengzoe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 - 2019 <a href="http://zengzoe.github.io">Zeng Zoe</a>, unless otherwise noted.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>