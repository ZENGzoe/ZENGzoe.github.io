<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 基于刮刮卡vue组件发布一个npm包 · 曾洁仪博客</title><meta name="description" content="基于刮刮卡vue组件发布一个npm包 - Zeng Zoe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="css/googleapisFonts.css" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/zengjieyi1994" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ZENGzoe" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><span style="display:none !important;"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span></span></span><article class="post-block"><h1 class="post-title">基于刮刮卡vue组件发布一个npm包</h1><div class="post-time">2018年10月21日</div><div class="post-content"><p><img src="/2018/10/21/基于刮刮卡vue组件发布一个npm包/luckymask.png" alt=""></p>
<p><a href="#一、前言">一、前言</a><br><a href="#二、刮刮卡vue组件的实现">二、刮刮卡vue组件的实现</a><br><a href="#三、发布到npm">三、发布到npm</a><br><a href="#四、安装使用包">四、安装使用包</a><br><a href="#五、总结">五、总结</a></p>
<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>项目中需要实现一个刮刮卡的模块，项目结束后沉淀项目时刚好可以把刮刮卡模块封装好，在下次新的项目中要用到时，可以更好的提高项目的效率，当然也更好地提供给其他小伙伴使用。</p>
<p>源码地址：<a href="https://github.com/ZENGzoe/vue-scratch-card" target="_blank" rel="noopener">https://github.com/ZENGzoe/vue-scratch-card</a><br>npm包地址：<a href="https://www.npmjs.com/package/vue-scratch-card0" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-scratch-card0</a></p>
<p>刮刮卡组件的效果如下：</p>
<p><img src="/2018/10/21/基于刮刮卡vue组件发布一个npm包/scratchCard.gif" alt=""></p>
<h2 id="二、刮刮卡vue组件的实现"><a href="#二、刮刮卡vue组件的实现" class="headerlink" title="二、刮刮卡vue组件的实现"></a>二、刮刮卡vue组件的实现</h2><p>刮刮卡功能的实现可以分三步：</p>
<h4 id="1-工作流的搭建"><a href="#1-工作流的搭建" class="headerlink" title="1.工作流的搭建"></a>1.工作流的搭建</h4><p>工作流使用的是<code>vue-cli</code>的<code>webpack-simple</code>模版，能够满足组件基本的编译要求：</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">vue init webpack-<span class="built_in">simple</span> vue-scratch-card</span><br></pre></td></tr></table></figure>
<p>执行后，根据组件录入package.json的信息。</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Use</span> sass? (y/<span class="keyword">N</span>) <span class="built_in">y</span></span><br></pre></td></tr></table></figure>
<p>在项目这里我选择的是<code>use sass</code>。</p>
<p>在<code>src</code>目录下创建<code>packages</code>目录，用于存放所有的子组件，在本组件中只有一个刮刮卡组件，因此在<code>packages</code>里新建<code>scratch-card</code>目录用于存放我们的刮刮卡组件。如果还有其他子组件，可以继续在<code>packages</code>添加子组件，最终目录如下：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">.</span><br><span class="line">├── README.md</span><br><span class="line">├── index.html</span><br><span class="line">├── node_modules</span><br><span class="line">├── package-lock.json</span><br><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── App.vue</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   └── logo.png</span><br><span class="line">│   ├── main<span class="selector-class">.js</span>             <span class="comment">//组合所有子组件，封装组件</span></span><br><span class="line">│   ├── main<span class="selector-class">.js</span>             <span class="comment">//入口文件</span></span><br><span class="line">│   └── packages            <span class="comment">//用于存放所有的子组件</span></span><br><span class="line">│       └── scratch-card    <span class="comment">//用于存放刮刮卡组件</span></span><br><span class="line">│           └── scratch-card<span class="selector-class">.vue</span>   <span class="comment">//刮刮卡组件代码</span></span><br><span class="line">└── webpack<span class="selector-class">.config</span><span class="selector-class">.js</span></span><br></pre></td></tr></table></figure>
<p>为了支持组件可以使用标签<code>&lt;script&gt;</code>的方式引入，封装成组件的打包文件只需要统一打包为js：</p>
<p><img src="/2018/10/21/基于刮刮卡vue组件发布一个npm包/dist.png" alt=""></p>
<p>因此需要修改我们的配置文件<code>webpack.config.js</code>：</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"> <span class="attribute">output</span>: &#123;</span><br><span class="line">    <span class="attribute">path</span>: path.resolve(__dirname, <span class="string">'./dist'</span>),</span><br><span class="line">    <span class="attribute">publicPath</span>: <span class="string">'/dist/'</span>,</span><br><span class="line">    <span class="attribute">filename</span>: <span class="string">'vue-scratch-card.js'</span>,</span><br><span class="line">    <span class="attribute">library </span>: <span class="string">'vue-scratch-card'</span>,  <span class="comment">//设置的是使用require时的模块名</span></span><br><span class="line">    <span class="attribute">libraryTarget </span>: <span class="string">'umd'</span>,    <span class="comment">//libraryTarget可以设置不同的umd代码，可以是commonjs标准、amd标准，也可以生成通过script标签引入的</span></span><br><span class="line">    <span class="attribute">umdNamedDefine </span>: true,    <span class="comment">//会对UMD的构建过程中的amd模块进行命名，否则就用匿名的define</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>同时，为了保留打包的<code>dist</code>目录，需要在<code>.gitignore</code>中去掉<code>dist</code>目录。</p>
<p><br></p>
<h4 id="2-canvas实现刮刮卡"><a href="#2-canvas实现刮刮卡" class="headerlink" title="2.canvas实现刮刮卡"></a>2.canvas实现刮刮卡</h4><p>刮刮卡主要是通过<code>Canvas</code>实现，一般刮刮卡是和抽奖结合，那么我们的<code>DOM</code>应该要包含可以显示抽奖结果的<code>DOM</code>，结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scratch-card.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div :id=<span class="string">'elementId'</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">'scratchCard'</span>&gt;</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"result"</span> v-show=<span class="string">'showLucky'</span>&gt;</span><br><span class="line">            &lt;slot name=<span class="string">'result'</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line">            &lt;img :src=<span class="string">"resultImg"</span> alt=<span class="string">""</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"pic"</span> /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;canvas id='scratchCanvas'&gt;&lt;/</span>canvas&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>template&gt;</span><br></pre></td></tr></table></figure>
<p>其中，添加了一个<code>&lt;slot&gt;</code>插槽，为了可以在调用这个组件时，定制抽奖结果的<code>DOM</code>。</p>
<p>接下来是实现刮刮卡的逻辑部分。</p>
<p>大致js结构如下：</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scratch-card.vue</span></span><br><span class="line">    export <span class="keyword">default</span> &#123;</span><br><span class="line">        <span class="string">name :</span> <span class="string">'vueScratchCard'</span>,</span><br><span class="line">        data()&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">supportTouch :</span> <span class="literal">false</span>,       <span class="comment">//是否支持touch事件</span></span><br><span class="line">                <span class="string">events :</span> [],                <span class="comment">//touch事件 or mouse事件合集</span></span><br><span class="line">                <span class="string">startMoveHandler :</span> <span class="literal">null</span>,     <span class="comment">//touchstart or mousedown 事件</span></span><br><span class="line">                <span class="string">moveHandler :</span> <span class="literal">null</span>,         <span class="comment">//touchmove or mousemove 事件</span></span><br><span class="line">                <span class="string">endMoveHandler :</span> <span class="literal">null</span>,      <span class="comment">//touchend or mouseend 事件</span></span><br><span class="line">                <span class="string">showLucky :</span> <span class="literal">false</span>,          <span class="comment">//显示隐藏抽奖结果</span></span><br><span class="line">                <span class="string">firstTouch :</span> <span class="literal">true</span>,          <span class="comment">//是否第一次touchstart or mousedown</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">props :</span> &#123;</span><br><span class="line">            <span class="string">elementId :</span> &#123;   <span class="comment">//组件最外层DOM的id属性</span></span><br><span class="line">                <span class="string">type :</span> String,</span><br><span class="line">                <span class="string">default :</span> <span class="string">'scratch'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">moveRadius :</span> &#123;  <span class="comment">//刮刮范围</span></span><br><span class="line">                <span class="string">type :</span> Number,</span><br><span class="line">                <span class="string">default :</span> <span class="number">15</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">ratio :</span> &#123;   <span class="comment">//要求刮掉的面积占比，达到这个占比后，将会自动把其余区域清除</span></span><br><span class="line">                <span class="string">type :</span> Number,</span><br><span class="line">                <span class="string">default :</span> <span class="number">0.3</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">startCallback :</span> &#123;   <span class="comment">//第一次刮回调函数</span></span><br><span class="line">                <span class="string">type :</span> Function,</span><br><span class="line">                <span class="string">default :</span> function()&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">clearCallback :</span> &#123;   <span class="comment">//达到ratio占比后的回调函数</span></span><br><span class="line">                <span class="string">type :</span> Function ,</span><br><span class="line">                <span class="string">default :</span> function()&#123;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">coverColor :</span> &#123;  <span class="comment">//刮刮卡遮罩颜色</span></span><br><span class="line">                <span class="string">type :</span> String,</span><br><span class="line">                <span class="string">default :</span> <span class="string">'#C5C5C5'</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">coverImg :</span> &#123;    <span class="comment">//刮刮卡遮罩图片</span></span><br><span class="line">                <span class="string">type :</span> String,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">resultImg :</span> &#123;       <span class="comment">//中奖的图</span></span><br><span class="line">                <span class="string">type :</span> String,</span><br><span class="line">                <span class="string">default :</span> <span class="string">'https://raw.githubusercontent.com/ZENGzoe/imagesCollection/master/2018/default.jpg'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">mounted :</span> function()&#123;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">methods :</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>开始编写逻辑之前，需要考虑组件可配置属性，添加到<code>props</code>中，让组件的使用能够更加灵活。</p>
<p>在组件挂载到实例中时，开始初始化组件，绘制<code>Canvas</code>。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scratch-card.vue</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">mounted : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br><span class="line">methods : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    init : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.isSupportCanvas)&#123;</span><br><span class="line">            alert(<span class="string">'当前浏览器不支持canvas'</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> canvasWrap = <span class="built_in">document</span>.getElementById(<span class="keyword">this</span>.elementId);</span><br><span class="line">        <span class="keyword">this</span>.canvas =canvasWrap.querySelector(<span class="string">'#scratchCanvas'</span>);</span><br><span class="line">        <span class="keyword">this</span>.ctx = <span class="keyword">this</span>.canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">        <span class="keyword">this</span>.canvas.width = canvasWrap.clientWidth;</span><br><span class="line">        <span class="keyword">this</span>.canvas.height = canvasWrap.clientHeight;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.createCanvasStyle();</span><br><span class="line">    &#125;,</span><br><span class="line">    createCanvasStyle : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _this = <span class="keyword">this</span>;</span><br><span class="line">        <span class="comment">//当传入coverImg时，优先使用图片，否则使用颜色作为刮刮卡遮罩</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.coverImg)&#123;</span><br><span class="line">            <span class="keyword">var</span> coverImg = <span class="keyword">new</span> Image();</span><br><span class="line">            coverImg.src = <span class="keyword">this</span>.coverImg;</span><br><span class="line">            coverImg.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                _this.ctx.drawImage(coverImg , <span class="number">0</span> , <span class="number">0</span> , _this.canvas.width , _this.canvas.height);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            _this.ctx.fillStyle = _this.coverColor;</span><br><span class="line">            _this.ctx.fillRect(<span class="number">0</span>,<span class="number">0</span>,_this.canvas.width , _this.canvas.height);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>当需要向<code>Canvas</code>添加跨域图片时，需要将图片转为base64。</p>
<p>｀PC<code>页面绑定的事件为</code>mousesdown<code>、</code>mousemove<code>、</code>mouseup<code>，移动端页面中绑定的事件为</code>touchstart<code>、</code>touchmove<code>、</code>touchend`，因此需要区分在不同端的事件绑定。</p>
<figure class="highlight qml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scratch-card.vue</span></span><br><span class="line">...</span><br><span class="line"><span class="attribute">init</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">this</span>.bindEvent();</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attribute">bindEvent</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">'ontouchstart'</span> <span class="keyword">in</span> <span class="built_in">window</span>) <span class="keyword">this</span>.supportTouch = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.events = <span class="keyword">this</span>.supportTouch ? [<span class="string">'touchstart'</span>, <span class="string">'touchmove'</span>, <span class="string">'touchend'</span>] : [<span class="string">'mousedown'</span>, <span class="string">'mousemove'</span>, <span class="string">'mouseup'</span>];</span><br><span class="line">    <span class="keyword">this</span>.addEvent();</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>为了减少篇幅，绑定事件<code>addEvent</code>的具体实现，可以查看源码。</p>
<p>刮刮卡擦拭的效果由<code>Canvas</code>的<code>globalCompositeOperation</code>属性实现，设置<code>globalCompositeOperation = &quot;destination-out&quot;</code>让手指或鼠标与<code>Canvas</code>画布重合区域不可见，就可以让刮刮卡的擦拭效果。在<code>touchmove</code>和<code>mousemove</code>绑定的事件中添加擦拭效果。实现如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">moveEventHandler : <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    </span><br><span class="line">    e = <span class="keyword">this</span>.supportTouch ? e.touches[<span class="number">0</span>] : e;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> canvasPos = <span class="keyword">this</span>.canvas.getBoundingClientRect(),</span><br><span class="line">          scrollT = <span class="built_in">document</span>.documentElement.scrollTop || <span class="built_in">document</span>.body.scrollTop,</span><br><span class="line">          scrollL = <span class="built_in">document</span>.documentElement.scrollLeft || <span class="built_in">document</span>.body.scrollLeft,</span><br><span class="line">           <span class="comment">//获取鼠标或手指在canvas画布的位置</span></span><br><span class="line">          mouseX = e.pageX - canvasPos.left - scrollL, </span><br><span class="line">          mouseY = e.pageY - canvasPos.top - scrollT;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.ctx.beginPath();</span><br><span class="line">    <span class="keyword">this</span>.ctx.fillStyle = <span class="string">'#FFFFFF'</span>;</span><br><span class="line">    <span class="keyword">this</span>.ctx.globalCompositeOperation = <span class="string">"destination-out"</span>;</span><br><span class="line">    <span class="keyword">this</span>.ctx.arc(mouseX, mouseY, <span class="keyword">this</span>.moveRadius, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI);</span><br><span class="line">    <span class="keyword">this</span>.ctx.fill();</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>每次手指或鼠标离开时，计算擦拭区域，当擦去的区域大于画布的约定的百分比时，清除整个<code>Canvas</code>画布。擦拭区域的计算相当于计算画布上的像素点是否还有数据，通过<code>getImageData</code>方法可获取画布的像素点。具体实现如下：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">caleArea : function()&#123;</span><br><span class="line">    let pixels = <span class="keyword">this</span>.ctx.getImageData(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.canvas.width,<span class="keyword">this</span>.canvas.height),</span><br><span class="line">        transPixels = [];</span><br><span class="line">    </span><br><span class="line">    pixels.<span class="keyword">data</span>.map((item , i) =&gt; &#123;</span><br><span class="line">        const pixel = pixels.<span class="keyword">data</span>[i+<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">if</span>(pixel === <span class="number">0</span>)&#123;</span><br><span class="line">            transPixels.push(pixel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(transPixels.length / pixels.<span class="keyword">data</span>.length &gt; <span class="keyword">this</span>.ratio)&#123;</span><br><span class="line">        <span class="keyword">this</span>.ctx.clearRect(<span class="number">0</span>,<span class="number">0</span>,<span class="keyword">this</span>.canvas.width , <span class="keyword">this</span>.canvas.height);</span><br><span class="line">        <span class="keyword">this</span>.canvas.removeEventListener(<span class="keyword">this</span>.events[<span class="number">0</span>],<span class="keyword">this</span>.startMoveHandler);</span><br><span class="line">        <span class="keyword">this</span>.canvas.removeEventListener(<span class="keyword">this</span>.events[<span class="number">1</span>] , <span class="keyword">this</span>.moveHandler , <span class="literal">false</span>);</span><br><span class="line">        document.removeEventListener(<span class="keyword">this</span>.events[<span class="number">2</span>] , <span class="keyword">this</span>.endMoveHandler , <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.clearCallback();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>每次手指或鼠标离开时，为了不污染其他区域的事件和占用内容，要清除绑定的事件。</p>
<p>那么到这里就实现了刮刮卡的所有逻辑，接下来就是要将刮刮卡组件封装成插件。</p>
<p><br></p>
<h4 id="3-封装成插件"><a href="#3-封装成插件" class="headerlink" title="3.封装成插件"></a>3.封装成插件</h4><p>将VUE组件封装成插件，就应该有一个公开的<code>install</code>方法，这样才可以通过<code>Vue.use()</code>调用插件。详细介绍可以看VUE的<a href="https://cn.vuejs.org/v2/guide/plugins.html" target="_blank" rel="noopener">官方文档</a>。</p>
<p>在<code>scratch-card</code>目录中新建<code>index.js</code>，用来封装<code>scratchCard</code>的<code>install</code>方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//scratch-card/index.js</span></span><br><span class="line"><span class="keyword">import</span> vueScratchCard <span class="keyword">from</span> <span class="string">'./scratch-card'</span></span><br><span class="line"></span><br><span class="line">vueScratchCard.install = <span class="function"><span class="params">Vue</span> =&gt;</span> Vue.component(vueScratchCard.name , vueScratchCard);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">window</span>.Vue)&#123;</span><br><span class="line">    <span class="built_in">window</span>.Vue.use(vueScratchCard);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vueScratchCard;</span><br></pre></td></tr></table></figure>
<p>到这里我们封装好了我们的子组件刮刮卡，如果有其他子组件，可以继续往<code>packages</code>目录中添加，最后在<code>src</code>目录下新建<code>index.js</code>，组合所有的子组件。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//src/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> VueScratchCard <span class="keyword">from</span> <span class="string">'./packages/scratch-card/index.js'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> install = <span class="function"><span class="keyword">function</span>(<span class="params">Vue , opts = &#123;&#125;</span>)</span>&#123;</span><br><span class="line">    Vue.component(VueScratchCard.name , VueScratchCard);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//支持使用标签&lt;script&gt;的方式引入</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">window</span> !== <span class="string">'undefined'</span> &amp;&amp; <span class="built_in">window</span>.Vue)&#123;</span><br><span class="line">    install(<span class="built_in">window</span>.Vue);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install ,</span><br><span class="line">    VueScratchCard</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样就完成了我们的组件啦～～</p>
<h2 id="三、发布到npm"><a href="#三、发布到npm" class="headerlink" title="三、发布到npm"></a>三、发布到npm</h2><p>发布到<code>npm</code>前，需要修改<code>package.json</code>，设置<code>&quot;private&quot;:true</code>，否则<code>npm</code>会拒绝发布私有包。除此之外，还需要添加入口文件，<code>&quot;main&quot;:&quot;dist/vue-scratch-card.js&quot;</code>，可以在当<code>require</code>或<code>import</code>包时加载模块。</p>
<figure class="highlight actionscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line">  <span class="string">"private"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"main"</span> : <span class="string">"dist/vue-scratch-card.js"</span>,</span><br></pre></td></tr></table></figure>
<p>npm发布流程如下：</p>
<p>1.在<a href="https://www.npmjs.com" target="_blank" rel="noopener">npm</a>注册账号</p>
<p>2.登陆npm，需要将镜像地址改为npm</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> login</span><br></pre></td></tr></table></figure>
<p>3.添加用户信息，输入账号密码</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> adduser</span><br></pre></td></tr></table></figure>
<p>4.发布</p>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">npm</span> publish</span><br></pre></td></tr></table></figure>
<p>发布成功后，就可以在<a href="https://www.npmjs.com" target="_blank" rel="noopener">npm</a>搜索到发布的包。</p>
<p><br></p>
<h2 id="四、安装使用包"><a href="#四、安装使用包" class="headerlink" title="四、安装使用包"></a>四、安装使用包</h2><p>之后我们就可以在直接安装使用了～～</p>
<p>安装：</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">npm <span class="keyword">install </span>vue-<span class="keyword">scratch-card0 </span>-S</span><br></pre></td></tr></table></figure>
<p>使用：</p>
<p>1.通过import使用</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">import ScratchCard from <span class="string">'vue-scratch-card0'</span></span><br><span class="line">Vue.<span class="keyword">use</span>(ScratchCard)</span><br><span class="line"></span><br><span class="line">&lt;vue-scratch-card </span><br><span class="line">    element-id=<span class="string">'scratchWrap'</span></span><br><span class="line">    <span class="symbol">:ratio=</span><span class="number">0</span>.<span class="number">5</span></span><br><span class="line">    <span class="symbol">:move-radius=</span><span class="number">50</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>2.通过标签<code>&lt;script&gt;</code>引用</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">vue-scratch-card</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">element-id</span>=<span class="string">'scratchWrap'</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:ratio</span>=<span class="string">0.5</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:move-radius</span>=<span class="string">50</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:start-callback</span>=<span class="string">startCallback</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:clear-callback</span>=<span class="string">clearCallback</span></span></span><br><span class="line"><span class="tag">    <span class="attr">cover-color</span>=<span class="string">'#caa'</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./node_modules/vue/dist/vue.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="actionscript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="actionscript">      el : <span class="string">'#app'</span>,</span></span><br><span class="line"><span class="undefined">      data () &#123;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="undefined">      methods : &#123;</span></span><br><span class="line"><span class="undefined">        startCallback()&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">'抽奖成功！'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;,</span></span><br><span class="line"><span class="undefined">        clearCallback()&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">'清除完毕！'</span>)</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>发布npm包时，一直提示<code>Package name too similar to existing packages</code>，但是在npm官网中，又没有查到命名相同的包，这个时候就不停的换<code>package.json</code>中的name，最后终于发布成功了，太不容易了～_～</p>
</div></article></div></section><footer><div class="paginator"><a href="/2018/11/18/面对JS的Event-Loop终于不懵逼/" class="prev">上一篇</a><a href="/2018/09/24/正则表达式/" class="next">下一篇</a></div><div data-thread-key="2018/10/21/基于刮刮卡vue组件发布一个npm包/" data-title="基于刮刮卡vue组件发布一个npm包" data-url="http://zengzoe.github.io/2018/10/21/基于刮刮卡vue组件发布一个npm包/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"zengzoe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2016 - 2018 <a href="http://zengzoe.github.io">Zeng Zoe</a>, unless otherwise noted.</p><p style="display:none !important;"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span><span id="busuanzi_container_site_uv">本站总访客数<span id="busuanzi_value_site_uv"></span>人次</span></p></div></footer><script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>